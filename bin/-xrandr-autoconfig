#!/bin/sh

export VGA1=/sys/class/drm/card0-VGA-1/

updateVGA1() {
	local status="$(cat $VGA1/status)"
	echo $status

	if [ "${status}" = disconnected ]; then
		xrandr --output VGA1 --off
	elif [ "${status}" = connected ]; then
		if grep "ViewSonic" $VGA1/edid; then
			xrandr --output VGA1 --auto --left-of LVDS1
		else
			xrandr --auto
			cat $VGA1/edid
		fi
	fi
}

update() {
	updateVGA1
	xrandr --output LVDS1 --mode 1366x768
}

update

while inotifywait -e modify,create,delete,open,close,close_write,access $VGA1/status; do
	update
done