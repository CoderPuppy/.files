#!/bin/bash
sink=$(pacmd list-sinks | ag '\* index' | sed 's/^  \* index: //')
mute=$(pacmd list-sinks | grep -A15 '* index' | ag '^\s*muted: ' | sed 's/^\s*muted:\s*//')
volume=$(pacmd list-sinks | grep -A15 '* index' | ag '^\s*volume: ' | ag -o '\d+%' | ag -o '\d+' | tail -n1)
volume=$(($volume / 2))

case $1 in
	+)
		volume=$((volume + 1))
		;;

	-)
		volume=$((volume - 1))
		;;

	m)
		if [[ "$mute" = "yes" ]]; then
			pactl set-sink-mute $sink no
			mute=no
		else
			pactl set-sink-mute $sink yes
			mute=yes
		fi
		;;

	*)
		if [[ "$1" != "" ]]; then
			volume=$1
		fi
		;;
esac
(( $volume > 50 )) && volume=50
(( $volume < 0 )) && volume=0
pactl set-sink-volume $sink $(($volume * 2))%
out="Volume "
if [[ "$mute" = "yes" ]]; then
	out="Muted "
fi
out="$out[$(bar 50 $volume)]"
echo "$out"
id=/run/user/$(id -u)/$DISPLAY-volume.notify-id
[[ -f $id && "$(cat $id)" != "" ]] || echo 0 > $id
notify-send -t 2000 -p -r $(cat $id) "$out" > $id
