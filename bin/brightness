#!/bin/bash
(
	flock -xn 200 || exit

	get() {
		cat /sys/class/backlight/acpi_video0/brightness
	}
	change() {
		echo -n
	}
	current=$(get)

	case $1 in
		+)
			current=$(($current + 1))
			;;
		
		-)
			current=$(($current - 1))
			;;

		*)
			if [[ "$1" != "" ]]; then
				current=$1
			fi
			;;
	esac
	(( $current > 15 )) && current=15
	(( $current < 0 )) && current=0
	change $current
	out="â˜€ [$(bar 15 $current)]"
	echo "$out"
	id=/run/user/$(id -u)/$DISPLAY-backlight.notify-id
	[[ -f $id ]] || echo 0 > $id
	ag '^\d' $id > /dev/null || echo 0 > $id
	notify-send.sh -t 2000 -p -r "$(cat $id)" "$out" > $id
	if [[ $(get) != $current ]]; then
		echo $(get) $current
	fi
) 200>/run/user/$(id -u)/$DISPLAY-backlight.lock
